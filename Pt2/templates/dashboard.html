{% extends 'layout.html' %}
{% block content %}
<h2>Welcome, {{ name }}!</h2>

<!-- List all users -->
<h4>All Users</h4>
<div class="user-list-scroll mb-4">
  <ul class="list-group mb-0">
    {% for user in users %}
      <li class="list-group-item">{{ user.fullname }} ({{ user.username }})</li>
    {% endfor %}
  </ul>
</div>

<!-- Task creation form -->
<h4>Create a Task</h4>
<form method="POST">
    {{ form.hidden_tag() }}
    <div class="mb-3">
        {{ form.title.label }} {{ form.title(class="form-control") }}
    </div>
    <div class="mb-3">
        {{ form.description.label }} {{ form.description(class="form-control") }}
    </div>
    <div class="mb-3">
        {{ form.assigned_to.label }} {{ form.assigned_to(class="form-select") }}
    </div>
    {{ form.submit(class="btn btn-primary") }}
</form>

<!-- Existing tasks -->
<h4 class="mt-5">All Tasks</h4>
<ul class="list-group">
  {% for task in tasks %}
    <li class="list-group-item d-flex justify-content-between align-items-center
        {% if task.assigned_to.username == session['username'] %}list-group-item-info{% endif %}">
      <div>
        <strong {% if task.completed %}style="text-decoration: line-through;"{% endif %}>
          {{ task.title }}
        </strong>
        <small class="text-muted">
          - {{ task.description }} ({{ task.assigned_to.fullname }})
        </small>
      </div>
      <div class="d-flex gap-1">
        <!-- Mark Complete/Incomplete -->
        <form method="POST" action="{{ url_for('complete_task', task_id=task.id) }}" style="display:inline;">
          <button class="btn btn-sm btn-outline-success" title="Toggle Complete">âœ“</button>
        </form>

        <!-- Edit Task -->
        <a href="{{ url_for('edit_task', task_id=task.id) }}" class="btn btn-sm btn-outline-primary" title="Edit">âœŽ</a>

        <!-- Delete Task -->
        <form method="POST" action="{{ url_for('delete_task', task_id=task.id) }}"
              style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this task?');">
          <button class="btn btn-sm btn-outline-danger" title="Delete">ðŸ—‘</button>
        </form>
      </div>
    </li>
  {% endfor %}
</ul>

<a href="{{ url_for('logout') }}" class="btn btn-danger mt-4">Logout</a>
{% endblock %}
